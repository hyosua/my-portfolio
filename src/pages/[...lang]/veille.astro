---
import Layout from "@/layouts/Layout.astro";
import GlassHeader from "@/components/GlassHeader";
import Footer from "@/components/Footer";
import VeilleSection from "@/components/VeilleSection";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { getCollection } from "astro:content";
import { ChevronLeft } from "lucide-react";

export function getStaticPaths() {
  return [
    { params: { lang: undefined } }, // racine (fr)
    { params: { lang: "en" } }, // anglais
  ];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const allVeille = await getCollection("veille");
const filteredArticles = allVeille.filter((article) => 
  article.slug.startsWith(`${lang}/`)
);
const articles = filteredArticles.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

const homeUrl = lang === "fr" ? "/" : `/${lang}/`;
---

<Layout lang={lang} description={t("head.description")}>
  <GlassHeader client:load lang={lang} />
  <main class="min-h-screen pt-32 pb-24">
    <div class="container max-w-4xl mx-auto px-6 md:px-4 mb-8">
      <a 
        href={homeUrl} 
        class="inline-flex items-center text-sm font-bold text-primary hover:opacity-70 transition-all uppercase tracking-widest"
      >
        <ChevronLeft class="mr-2" size={20} />
        {t("veille.back")}
      </a>
    </div>

    <VeilleSection 
      client:load
      title={t("section.veille")} 
      lang={lang} 
      articles={articles}
      showMoreButton={false}
    />
  </main>
  <Footer client:visible />
</Layout>
